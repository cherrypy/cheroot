Fixed race conditions to make socket I/O more resilient during connection teardown.

-- by :user:`julianz-`
